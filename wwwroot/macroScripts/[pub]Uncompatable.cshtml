@using umbraco.NodeFactory @using System.Web.UI.HtmlControls @try { var HARDCODED_Настройкисайта = 1070; if (uQuery.GetNode(HARDCODED_Настройкисайта).GetProperty<bool>("enableFeedback")) {<div class="forms fbForm">
	<script type="text/javascript" src="/scripts/jquery-ui.js"></script>
	
	<link href="/css/jquery-ui.css" rel="stylesheet" type="text/css" media="screen">
	

		
	<div class="header zoom">Регистрация случая отказа от погрузки в вагоны АО «ФГК»</div>
		<div class="formsBlock">
		
			<form id="fbForm" method="post" action="/Uncompatable" enctype="multipart/form-data" runat="server">
				<fieldset>
				
					<div class="infoMsg">Благодарим. Сообщение успешно отправлено. Мы обязательно Вам ответим.</div>
					
					<div class="userinfo">
						<div class="left">	
							<span class="errorMsg" style="display: none;">Не введено название</span>
							<label for="org">Организация
							</label>
							<input type="text" class="txt" title="Название организации" id="org" name="org" required />
						</div>
						
						<div class="right">
							<span class="errorMsg" style="display: none;">Не введено ФИО</span>
							<label for="fio">ФИО
							</label>
							<input type="text" class="txt" title="ФИО обратившегося" id="fio" name="fio" required />
						</div>
						
						<div class="left">	
							<span class="errorMsg" style="display: none;">@Dictionary["[forms][feedback]EmailValMess"]</span>
							<label for="email">&#9993; E-mail 
							</label>
							<input type="email"  class="txt" title="@Dictionary["[forms][feedback]EmailHint"]" id="email" required name="email" />
						</div>
						
						<div class="right">
							<span class="errorMsg" style="display: none;">@Dictionary["[forms][feedback]PhoneValMess"]</span>
							<label for="phone">&#9742; Телефон 
							</label>
							<input type="tel" class="txt" title="@Dictionary["[forms][feedback]PhoneHint"]" id="phone" name="phone" />
						</div>
					</div>
					
					
					<div class="vaginfo">
						
					<div class="left">
						<span class="errorMsg" style="display: none;">@Dictionary["[forms][feedback]CategoryValMess"]</span>
						<label for="vagnum">Номер вагона</label>
							<input type="number" max="99999999" min="11111111" maxlength="8" name="vagnum" required title="Введите 8-ми значный номер вагона"/>
						</div>
							
					<div class="right">
						<label for="category">Род вагона</label>
						<select class="txt" id="category" name="category" required title="Выберите род вагона">
							<option value="1">Полувагон</option>
							<option value="2">Цистерна</option>
							<option value="3">Платформа</option>
							<option value="4">Крытый</option>
						</select>
					</div>	
							
					<div class="left">		
						<span class="errorMsg" style="display: none;">Не введена дата отказа</span>
						<label for="date">Дата отказа
						</label>
						<input type="date" class="txt" title="Введите дату отказа" id="date" name="date" min="2016-05-01" max="2025-12-31" required  />
					</div>
							
					<div class="right">		
						<span class="errorMsg" style="display: none;">Не введена станция отказа</span>
						<label for="station">Станция отказа
						</label>
						<input type="text" class="txt" title="Выберите станцию отказа" id="station" name="station" required />
					</div>	
							
					<div class="r-right">		
						<span class="errorMsg" style="display: none;">Не введен груз</span>
						<label for="freight">Вагон не принят под погрузку груза
						</label>
						<input type="text" class="txt" title="Выберите груз" id="freight" name="freight" required />
					</div>	
					@*		
					<div class="left">		
						<span class="errorMsg" style="display: none;">Не введена категория отказа</span>
						<label for="cat">Категория отказа<sup class="isrequired"/>
						</label>
						<input type="text" class="txt" title="Выберите категорию отказа" id="cat" name="cat" required />
					</div>	
							
					<div class="right">		
						<span class="errorMsg" style="display: none;">Не введена причина отказа</span>
						<label for="cause">Причина отказа<sup class="isrequired"/>
						</label>
						<input type="text" class="txt" title="Укажите причину отказа" id="cause" name="cause" required />
					</div>
					*@
							
							<div class="unc">
								<span class="errorMsg" style="display: none;">Не введена категория отказа</span>
								<label for="cat">Категория отказа
								</label>
								  <select class="txt" title="Выберите категорию отказа" id="cat" name="cat" required >
									<option value="1">Техническая непригодность</option>
									<option value="2">Коммерческая непригодность</option>
									<option value="3">Отказ грузоотправителя от использования годных вагонов</option>
								  </select>
								
									<span class="errorMsg" style="display: none;">Не введена причина отказа</span>
									<label for="cause">Причина отказа
									</label>
								  <select class="cause" disabled title="Укажите причину отказа" id="cause" name="cause" required >
									<option></option>
								  </select>
								
								</div>
							
					</div>
					
					
					<div class="dopinfo">
					
								<span class="errorMsg" style="display: none;">@Dictionary["[forms][feedback]MessageValMess"]</span>
								<label for="message">Примечание</label>
									<textarea class="ta" rows="5" cols="1"  title="@Dictionary["[forms][feedback]MessageHint"]" id="message" name="message"></textarea>
									
								<span class="errorMsg" style="display: none;" id='attch' name='attch'>123</span>
								<span class="errorMsg" style="display: none;">@Dictionary["[forms][feedback]FileValMessage"]</span>
								<label for="f2s">Приложение<br>
									<i>Не более 4 мегабайт!!!<br>
									<!---В случае необходимости отправки нескольких файлов, воспользуйтесь архиватором</i>---></label>
								<input type="file"  name="f2s" id="f2s" title="Файл для вложения:" runat="server" multiple="multiple">
									
									
									
									<span class="errorMsg captchaErr" style="display: none;">@Dictionary["[forms][feedback]CaptchaValMessage"]</span>
									<label for='txtCaptcha' class="capt_label">Введите код антиспам-защиты</label>
									<input type="text" class="txtt" id='txtCaptcha' title='Введите код с картинки' name='txtCaptcha' runat="server" />
									<img src="/Captcha.ashx"  id="cap" name="cap"  alt=" Для обновления кликните по картинке" title=" Для обновления кликните по картинке" width="75" height="22" alt="Captcha" style="margin-bottom: -7px;"/>
									<button id="go" class="fright" title="@Dictionary["[forms][feedback]SendHint"]" type="submit">@Dictionary["[forms][feedback]SendLabel"]</button>
									<div class="errorMsgImp" style="display: none;">@Dictionary["[forms][feedback]FailMess"]</div>
					</div>
					</fieldset>
				</form>
			</div>
		</div>	

										
										
<script>
//<![CDATA[
	
	

	
	
	
	
			var capVal=false;	
			var C=3;
			$('#cap').on('click',function(){
				$("#cap").attr("src", $("#cap").attr("src")+"?timestamp=" + new Date().getTime());
			});
			@*//генерим новую каптчу с дэйтстампом для уникальности при кешировании	*@
		
			$(document).ready(function(){
				$('input', $form).attr('placeholder', 'Обязательно для заполнения');
				$('#txtCaptcha', $form).attr('placeholder', 'Введите код с картинки');
				

		 
			});
		 
		  	var availableTags;
    		$.get("/media/81666/x-stations.txt", function(data) {
       			 availableTags = data.split(',');
        		 $( "#station" ).autocomplete({source:availableTags})
    		 });
	
		 
		 var availableTags;
    		$.get("/media/81975/x-freights.txt", function(data) {
       			 availableTags = data.split(',');
        		 $( "#freight" ).autocomplete({source:availableTags})
    		 });
		 
		 
		 
		
$(function() {
	
	if ( $('[type="date"]').prop('type') != 'date' ) {
    $('[type="date"]').datepicker();
}
		
	$.datepicker.regional['ru'] = {
closeText: 'Закрыть',
prevText: '&#x3c;Пред',
nextText: 'След&#x3e;',
currentText: 'Сегодня',
monthNames: ['Январь','Февраль','Март','Апрель','Май','Июнь',
'Июль','Август','Сентябрь','Октябрь','Ноябрь','Декабрь'],
monthNamesShort: ['Янв','Фев','Мар','Апр','Май','Июн',
'Июл','Авг','Сен','Окт','Ноя','Дек'],
dayNames: ['воскресенье','понедельник','вторник','среда','четверг','пятница','суббота'],
dayNamesShort: ['вск','пнд','втр','срд','чтв','птн','сбт'],
dayNamesMin: ['Вс','Пн','Вт','Ср','Чт','Пт','Сб'],
dateFormat: 'dd.mm.yy',
firstDay: 1,
isRTL: false,
changeMonth: true 
};
$.datepicker.setDefaults($.datepicker.regional['ru']);
	
var selectValues = {
    "1": {
      	"1":"Техническая неисправность",
        "2":"Истек межремонтный период"
    },
    "2": {
     "3.1":"Отсутствие промывки вагона",
     "3.2":"Некачественная промывка вагона",
      "3.3":"Наличие запаха или остатков груза в условиях, когда промывка не требовалась",
       "4":"Несоответствие требуемым технических характеристик вагона"      
    },
    "3": {
     "5":"Отсутствие груза",
     "6":"Прибытие вагонов в количестве сверх принятой заявки на перевозку ",
	 "7":"Отказ от порожнего вагона по причине просрочки доставки",
     "8":"Отказ от порожнего вагона по причине отсутствия согласованной заявки",
     "9":"Образование дебиторской задолженности по договору",
      "10":"Отправление заявленных  объемов меньшим количеством вагонов"
		 
    },

  };
var $menus = $(".unc select");
  $menus.change(function() {
    var val = $(this).val();
    console.log(val, $menus.index(this));

    $(this).next().next().next().empty().prop({
      disabled: false
    }).html(function() {
      var output = '';
      $.each(selectValues[val], function(key, value) {
        output += '<option>' +value + '</option>';
      });
      return output;
    }).nextAll().prop({
      disabled: true
    }).empty()
  }).first().change()

});		 
		 
var $form = $('#fbForm');
var valid = true;
var validno = true;

$("#f2s").on("change", function (e) { 						
	var files = e.currentTarget.files;
	var filename=$('#f2s').val();
	var Filesize = ((files[0].size/1024)).toFixed(2);
	var filesize = ((files[0].size/1024)/1024).toFixed(4);
	if (files[0].name != "item" && typeof files[0].name != "undefined" && filesize <= 4) {
		var $file = $("[name=f2s]", $form);
		$('#attch').text('Приложенный файл:'+filename+' '+Filesize+' кб');
		$('#attch').show();
		$file.prev().prev().hide(); 
		validno = true;
		}				
	else{
		var $file = $("[name=f2s]", $form);
		$file.prev().prev().show();
		$('#attch').hide();
		@*$file[0].focus();*@
		validno = false;
		}
	});
@*//Чекаем приложенный файл. Если размер <=4Мб, пишем путь, имя, размер, разрешаем отправку, если >, показываем предуперждение, отправку не разрешаем.*@
			
function tryCaptcha(){
	function getXmlHttp(){
  	var xmlhttp;
  	try {
  	  xmlhttp = new ActiveXObject("Msxml2.XMLHTTP");
  	} 
	catch (e) {
    		try {
      	xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    		}
		catch (E) {
      xmlhttp = false;
    }
  }
  if (!xmlhttp && typeof XMLHttpRequest!='undefined') {
    xmlhttp = new XMLHttpRequest();
  }
  return xmlhttp;
}	
var txtCaptcha = $("[name=txtCaptcha]", $form);
var Mxmlhttp = getXmlHttp()
Mxmlhttp.open('GET', '/CaptchaHandler1.ashx'+'?cap='+txtCaptcha.val(), false);
Mxmlhttp.send(null);	
     if(Mxmlhttp.status == 200) {

		 if (Mxmlhttp.responseText==1){
			 C=1;
			 
		}
		 else{
			 C=0;			 
			 }
		
       }
     
var $txtCaptcha = $("[name=txtCaptcha]", $form);
if (C==0) {
	$('.captchaErr').show();
	$txtCaptcha[0].focus();
	$("#cap").attr("src", $("#cap").attr("src")+"?timestamp=" + new Date().getTime());
		}
	else { 
		$('.captchaErr').hide(); 
		}
};



$("#fbForm").on("submit", function() {	
	var sending = false;
	tryCaptcha();
	$(".infoMsg, .errorMsgImp").hide();
	var $form = $(this);
	var valid = true;


@*поля проверяются в обратном порядке для более логичной фокусировки ошибочных полей*@
if (C==0) {			
	valid = false;
	}
	else{
		valid=true;
		}
	@*	
		var $message = $("[name=message]", $form);
		if ($.trim($message.val()) == "") {
			$message.prev().prev().show();
			$message[0].focus();
			valid = false;
		}
		else { $message.prev().prev().hide(); }
	
		var $message = $("[name=cause]", $form);
				if ($.trim($cause.val()) == "") {
					$cause.prev().prev().show();
					$cause[0].focus();
					valid = false;
				}
				else { $cause.prev().prev().hide(); }


		var $cat = $("[name=cat]", $form);
				if ($.trim($cat.val()) == "") {
					$cat.prev().prev().show();
					$cat[0].focus();
					valid = false;
				}
				else { $cat.prev().prev().hide(); }

		var $station = $("[name=station]", $form);
				if ($.trim($station.val()) == "") {
					$station.prev().prev().show();
					$station[0].focus();
					valid = false;
				}
				else { $station.prev().prev().hide(); }
		
		var $date = $("[name=date]", $form);
				if ($.trim($date.val()) == "") {
					$date.prev().prev().show();
					$date[0].focus();
					valid = false;
				}
				else { $date.prev().prev().hide(); }

		var $category = $("[name=category]", $form);
				if ($.trim($category.val()) == "") {
					$category.prev().prev().show();
					$category[0].focus();
					valid = false;
				}
				else { $category.prev().prev().hide(); }

		var $vagnum = $("[name=vagnum]", $form);
				if ($.trim($vagnum.val()) == "") {
					$vagnum.prev().prev().show();
					$vagnum[0].focus();
					valid = false;
				}
				else { $vagnum.prev().prev().hide(); }

		var $phone = $("[name=phone]", $form);
			if ($.trim($phone.val()) == "") {
				$phone.prev().prev().show();
				phone[0].focus();
				valid = false;
			}
			else { $phone.prev().prev().hide(); }

		var $email = $("[name=email]", $form);
				if (!/@Dictionary["[forms][common]EmailRegex"]/.test($.trim($email.val()))) {
					$email.prev().prev().show();
					$email[0].focus();
					valid = false;
				}
				else { $email.prev().prev().hide(); }

		var $fio = $("[name=fio]", $form);
			if ($.trim($fio.val()) == "") {
				$fio.prev().prev().show();
				fio[0].focus();
				valid = false;
			}
			else { $fio.prev().prev().hide(); }

		var $org = $("[name=org]", $form);
					if ($.trim($org.val()) == "") {
						$org.prev().prev().show();
						org[0].focus();
						valid = false;
					}
					else { $org.prev().prev().hide(); }
*@

	
		@*
		var $phone = $("[name=phone]", $form);
		var $email = $("[name=email]", $form);
		var $name = $("[name=name]", $form);
		
		$phone.prev().prev().hide();
		$email.prev().prev().hide();
		$name.prev().prev().hide();
		-----------------------------------------------------------------------
		$org.prev().prev().hide();
		$fio.prev().prev().hide();
		$email.prev().prev().hide();
		$phone.prev().prev().hide();
		$vagnum.prev().prev().hide();
		$date.prev().prev().hide();
		$station.prev().prev().hide();
		$cat.prev().prev().hide();
		$cause.prev().prev().hide();
	
	*@
		
	if (!validno) return false;
    if (!valid) return false;
    if (sending) return false
		 
		
		sending = true;
		
	
		
				
    var $button = $("[type=submit]", $form);				
    $button.width($button.outerWidth());				
    var buttonText = $button.html();				
    $button.html("<img src='/dsgn/sending.gif' alt='' />");
 
				var options = { 							 
							success:    function() { 
								$(".infoMsg", $form).show(); 
								$button.html(buttonText);
								sending = false;								
								$("#fbForm").trigger( 'reset' );								
								$('#email,#org,#fio,#vagnum,#station,#freight').attr('placeholder','Обязательно для заполнения');								
								$('#email,#phone,#org,#fio,#vagnum,#station,#freight,#txtCaptcha').val('');
									$('#txtCaptcha', $form).attr('placeholder', 'Введите код с картинки');
								$("#cap").attr("src", $("#cap").attr("src")+"?timestamp=" + new Date().getTime());
								$('.isrequired').show();
							},
								error: function() {
                        			$(".errorMsgImp", $form).show();
									
                    			}
							};
					@*Условия аяксовой отправки формы (откат к начальному состоянию, обновление капчи, снятие дефолтных значений при успехе и отображение ошибок при неудаче*@
$form.ajaxSubmit(options); 
             return false;
            });
        //]]>
</script>				
	
						
    }
}
catch(Exception e)
{
    umbraco.BusinessLogic.Log.Add(umbraco.BusinessLogic.LogTypes.Error, Model.Id, e.ToString());
    //<p>@e</p>
}